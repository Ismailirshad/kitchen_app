[
 {
  "breadcrumbs": null,
  "content_type": "HTML",
  "context_script": null,
  "css": null,
  "docstatus": 0,
  "doctype": "Web Page",
  "dynamic_route": 0,
  "dynamic_template": 1,
  "enable_comments": 0,
  "end_date": null,
  "full_width": 1,
  "header": null,
  "insert_style": 0,
  "javascript": "if (frappe.realtime) {\n    frappe.realtime.init();\n}\n\n// this is used to automatically fetch new listed orders using socket.io\nfrappe.realtime.on(\"new_kitchen_order\", function(data){\n    appendOrderCard(data)\n})\n\nfunction appendOrderCard(order){\n    const container = document.getElementById(`order-${order.status.toLowerCase()}`)\n    if(container){\n        container.innerHTML += cardTemplate(order)\n    }\n   \n    const count = document.getElementById(`count-${order.status.toLowerCase()}`)\n    if(count){\n        count.innerText = parseInt(count.innerText || 0)+1\n    }\n}\n\n// This is used to avoid csrf token error\nfrappe.csrf_token = document.getElementById('csrf_token').value;\n$.ajaxSetup({ headers: { 'X-Frappe-CSRF-Token': frappe.csrf_token } });\n\n\nfunction refresh(){\n    frappe.call({\n        method: \"frappe.client.get_list\",\n        args: {\n            doctype: \"Kitchen Order\",\n            fields: [\"name\", \"status\", \"kitchen_pos_invoice\"],\n            filters: { status: [\"not in\", [\"Supplied\"]] }\n        },\n        callback: (res) => getOrder(res.message || [])\n    })\n}\n\nfunction getOrder(orders){\n    const stages = [\"Received\", \"Collected\", \"Ready\"];\n   \n    stages.forEach(status => {\n        const filtered = orders.filter(o => o.status === status)\n        const length = filtered.length\n        const count = document.getElementById(`count-${status.toLowerCase()}`)\n        if(count){\n            count.innerText = length;\n        }\n       \n        const container = document.getElementById(`order-${status.toLowerCase()}`)\n        if(container){\n            container.innerHTML = filtered.map(item => cardTemplate(item)).join(\"\")\n        }\n    })\n}\n\nconst cardTemplate = (order) =>`\n<div class=\"order-card\" onClick=\"openModal('${order.name}','${order.status}','${order.kitchen_pos_invoice}')\">\n <b> ${order.name} </b> <br>\n <small> ${order.kitchen_pos_invoice} </small>\n </div>\n `;\n \n function openModal(name, status, invoice){\n    const modal = document.getElementById('modal-container')\n    document.getElementById('order-id').innerText = `Order ${name}`\n    document.getElementById('order-status').innerText = status\n   \n    modal.style.display = 'flex';\n   \n    // This call is used to get the items of the order\n    frappe.call({\n        method: \"frappe.client.get\",\n        args:{\n            doctype: \"POS Invoice\",\n            name: invoice\n        },\n        callback: function(res){\n            displayItems(res.message.items || [])\n        }\n    })\n   \n    document.getElementById('btn-next').onclick = () => {\n        const stages = [\"Received\", \"Collected\", \"Ready\", \"Supplied\"]\n        const nextStatus = stages[stages.indexOf(status) + 1]\n       \n        frappe.call({\n            method: \"frappe.client.set_value\",\n            args:{\n                doctype: \"Kitchen Order\",\n                name: name,\n                fieldname: \"status\",\n                value: nextStatus\n            },\n            callback: () =>{\n                closeModal();\n                refresh();\n            }\n        })\n    }\n }\n \n function displayItems(items){\n     const container = document.getElementById(\"order-items\")\n     if(container){\n         container.innerHTML = items.map(item => `\n         <div class=\"item-row\">\n         <b>Item:</b> ${item.item_name} - <b>Qty:</b> ${item.qty}\n         </div>\n         `).join(\"\")\n     }\n }\n \nconst closeModal = () => {\n    document.getElementById('modal-container').style.display = \"none\";\n}\n\nrefresh()",
  "main_section": null,
  "main_section_html": "<!--This line is used to avoid csrf token error-->\n<input type=\"hidden\" id=\"csrf_token\" value=\"{{ frappe.session.csrf_token }}\">\n\n<style>\nhtml,body{\n    height: 100%;\n    margin: 0 ;\n}\nbody {\n    background: #0f172a;\n    min-height:100vh;\n    display: flex;\n    flex-direction: column;\n    margin: 0;\n    font-family: Arial, sans-serif;\n}\n.navbar,\n.navbar-default,\n.footer,\n.web-footer,\n.page-footer {\n    display: none !important;\n}\n\n.container {\n    flex: 1;\n    padding: 20px;\n}\n\n.header {\n    text-align: center;\n    margin-bottom: 25px;\n}\n\n.title {\n    font-size: 28px;\n    font-weight: 600;\n    color: #38bdf8;\n}\n\n.main {\n    display: flex;\n    gap: 20px;\n    justify-content: center;\n    height: calc(100vh - 120px);\n}\n\n.section {\n    width: 32%;\n    background: #1e293b;\n    border-radius: 12px;\n    padding: 15px;\n    box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n    overflow-y: auto;\n}\n\n.heading {\n    font-size: 16px;\n    font-weight: 600;\n    padding: 10px;\n    border-radius: 8px;\n    text-align: center;\n    margin-bottom: 15px;\n    color: white;\n}\n\n.received {\n    background: linear-gradient(135deg, #2563eb, #1d4ed8);\n}\n\n.collected {\n    background: linear-gradient(135deg, #f59e0b, #d97706);\n}\n\n.ready {\n    background: linear-gradient(135deg, #16a34a, #15803d);\n}\n\n.order-card {\n    background: #334155;\n    color: #f1f5f9;\n    padding: 12px;\n    border-radius: 10px;\n    margin-bottom: 10px;\n    cursor: pointer;\n    transition: 0.2s;\n}\n\n.order-card:hover {\n    background: #475569;\n    transform: translateY(-3px);\n}\n\n.order-count {\n    background: white;\n    color: #0f172a;\n    border-radius: 50%;\n    padding: 2px 8px;\n    font-size: 12px;\n    margin-left: 6px;\n}\n\n\n.order-modal {\n    position: fixed;\n    inset: 0;\n    background: rgba(0,0,0,0.7);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n.modal-card {\n    background: #1e293b;\n    padding: 25px;\n    border-radius: 12px;\n    width: 450px;\n    color: white;\n}\n.modal-card h3 {\n    color: white;\n}\n\n.modal-actions {\n    display: flex;\n    gap: 10px;\n    margin-top: 20px;\n}\n\n.next-btn {\n    background: #16a34a;\n    color: white;\n    border: none;\n    padding: 10px;\n    border-radius: 8px;\n    cursor: pointer;\n    flex: 1;\n}\n\n.close-btn {\n    background: #ef4444;\n    color: white;\n    border: none;\n    padding: 10px;\n    border-radius: 8px;\n    cursor: pointer;\n    flex: 1;\n}\n</style>\n\n<div class=\"container\">\n        <div class=\"header\">\n            <h1 class=\"title\">KITCHEN-ORDER POS</h1>\n        </div>\n    <div class=\"main\">\n        <div class=\"section\">\n            <h3 class=\"heading received\">Received Orders <span id=\"count-received\" class=\"order-count\">0</span></h3>\n            <div id='order-received'></div>\n        </div>\n         <div class=\"section\">\n            <h3 class=\"heading collected\">Collected Orders <span id=\"count-collected\" class=\"order-count\">0</span></h3>\n            <div id='order-collected'></div>\n        </div>\n         <div class=\"section\">\n            <h3 class=\"heading ready\">Ready Orders <span id=\"count-ready\" class=\"order-count\">0</span></h3>\n            <div id='order-ready'></div>\n        </div>\n    </div>\n</div>\n<div id=\"modal-container\" class=\"order-modal\" style=\"display:none;\">\n    <div class=\"modal-card\">\n        <h3 id=\"order-id\">Order Details</h3>\n        <hr>\n        <p>Status <span id=\"order-status\"></span></p>\n        <div id=\"order-items\">Order Items</div>\n        <div class=\"modal-actions\">\n            <button class=\"close-btn\" onclick=\"closeModal()\">Close</button>\n            <button id=\"btn-next\" class=\"next-btn\">Move to Next Stage</button>\n        </div>\n    </div>\n</div>",
  "main_section_md": null,
  "meta_description": null,
  "meta_image": null,
  "meta_title": null,
  "modified": "2026-02-26 11:58:36.516267",
  "module": "Kitchen App",
  "name": "kitchen-app-management",
  "page_blocks": [],
  "published": 1,
  "route": "kitchen-order-management",
  "show_sidebar": 0,
  "show_title": 0,
  "slideshow": null,
  "start_date": null,
  "text_align": "Left",
  "title": "Kitchen App management",
  "website_sidebar": null
 }
]